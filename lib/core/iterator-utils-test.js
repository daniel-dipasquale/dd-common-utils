'use strict';

const { expect } = require('chai');

const Asserter = class {
    expectIsGeneratorWithOutput(generator, result) {
        expect(generator).to.satisfy(r => typeof r[Symbol.iterator] === 'function');
        expect(Array.from(generator)).to.eql(result);
    }

    expectIsGeneratorWithDoneAwareManualIteration(generator, result) {
        const iterator = generator[Symbol.iterator]();

        expect(iterator.done).to.be.undefined;

        const items = new Array(result.length).fill(0).map(() => iterator.next().value);

        expect(iterator.done).to.be.false;
        expect(items).to.eql(result);

        iterator.next();

        expect(iterator.done).to.be.true;
    }
};

describe('{ iteratorUtils } provides functionality that extends behavior for generators (a.k.a. iterator factories)', function () {
    const iteratorUtils = require('./iterator-utils.js');
    const asserter = new Asserter();

    context('{ iteratorUtils.default }', function () {
        context('when an iterable object is provided but a GENERATOR is needed', function () {
            it('creates a generator that iterates through the given array', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = ['t', 'e', 's', 't'];

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.default(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't']);
            });

            it('creates a generator that iterates through the given string', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.default(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't']);
            });

            it('creates a generator that iterates through the given generator', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = (function* () {
                    yield 't';
                    yield 'e';
                    yield 's';
                    yield 't';
                })();

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.default(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't']);
            });
        });

        context('when a NON-iterable object is provided but a GENERATOR is needed', function () {
            it('creates a generator that yields an empty set', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = null;

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.default(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, []);
            });
        });

        context('when an iterable object is provided but an ITERATOR is needed', function () {
            it('creates a generator that yields an iterator that iterates through every item one by one', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.default(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithDoneAwareManualIteration(result, ['t', 'e', 's', 't']);
            });
        });
    });

    context('{ iteratorUtils.skip }', function () {
        context('when an iterable object is provided but a GENERATOR that is able to skip the first N-TH items is needed', function () {
            it('creates a generator that iterates through the given array', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = ['t', 'e', 's', 't'];

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.skip(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['s', 't']);
            });

            it('creates a generator that iterates through the given string', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.skip(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['s', 't']);
            });

            it('creates a generator that iterates through the given generator', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = (function* () {
                    yield 't';
                    yield 'e';
                    yield 's';
                    yield 't';
                })();

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.skip(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['s', 't']);
            });
        });

        context('when an NON-iterable object is provided but a GENERATOR that is able to skip the first N-TH items is needed', function () {
            it('creates a generator that yields an empty set', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = null;

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.skip(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, []);
            });
        });

        context('when an iterable object is provided but a GENERATOR that skips more items that it has is needed', function () {
            it('creates a generator that yields an empty set', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = (function* () {
                    yield 't';
                    yield 'e';
                    yield 's';
                    yield 't';
                })();

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.skip(input, 5);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, []);
            });
        });

        context('when an iterable object is provided but an ITERATOR that is able to skip the first N-TH items is needed', function () {
            it('creates a generator that yields an iterator that iterates through every item after the first N-TH one, but one by one', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.skip(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithDoneAwareManualIteration(result, ['s', 't']);
            });
        });
    });

    context('{ iteratorUtils.reiterable }', function () {
        context('when an iterable object is provided but a GENERATOR that is able to reiterate through the items multiple times in a circle is needed', function () {
            it('creates a generator that iterates through the given array', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = ['t', 'e', 's', 't'];

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reiterable(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't', 't', 'e', 's', 't']);
            });

            it('creates a generator that iterates through the given string', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reiterable(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't', 't', 'e', 's', 't']);
            });

            it('creates a generator that iterates through the given generator', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = (function* () {
                    yield 't';
                    yield 'e';
                    yield 's';
                    yield 't';
                })();

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reiterable(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't', 't', 'e', 's', 't']);
            });
        });

        context('when an NON-iterable object is provided but a GENERATOR that is able to reiterate through the items multiple times in a circle is needed', function () {
            it('creates a generator that yields an empty set', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = null;

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reiterable(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, []);
            });
        });

        context('when an iterable object is provided but a GENERATOR is needed', function () {
            it('creates a generator that yields an empty set', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = ['t', 'e', 's', 't'];

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reiterable(input, 1);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 'e', 's', 't']);
            });
        });

        context('when an iterable object is provided but an ITERATOR that is able to reiterate through the items multiple times in a circle is needed', function () {
            it('creates a generator that yields an iterator that reiterates through every item multiple times in a circle, but one by one', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reiterable(input, 2);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithDoneAwareManualIteration(result, ['t', 'e', 's', 't', 't', 'e', 's', 't']);
            });
        });
    });

    context('{ iteratorUtils.reverse }', function () {
        context('when an iterable object is provided but a GENERATOR that is able to iterate through the items but in reverse order is needed', function () {
            it('creates a generator that iterates through the given array', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = ['t', 'e', 's', 't'];

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reverse(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 's', 'e', 't']);
            });

            it('creates a generator that iterates through the given string', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reverse(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 's', 'e', 't']);
            });

            it('creates a generator that iterates through the given generator', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = (function* () {
                    yield 't';
                    yield 'e';
                    yield 's';
                    yield 't';
                })();

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reverse(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, ['t', 's', 'e', 't']);
            });
        });

        context('when an NON-iterable object is provided but a GENERATOR that is able to iterate through the items but in reverse order is needed', function () {
            it('creates a generator that yields an empty set', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = null;

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reverse(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithOutput(result, []);
            });
        });

        context('when an iterable object is provided but an ITERATOR that is able to iterate through the items but in reverse order is needed', function () {
            it('creates a generator that yields an iterator that iterates through the items but in reverse order, and one by one', function () {
                // ==========================================================================================
                // ARRANGE ==================================================================================
                // ==========================================================================================
                const input = 'test';

                // ==========================================================================================
                // ACT ======================================================================================
                // ==========================================================================================
                const result = iteratorUtils.reverse(input);

                // ==========================================================================================
                // ASSERT ===================================================================================
                // ==========================================================================================
                asserter.expectIsGeneratorWithDoneAwareManualIteration(result, ['t', 's', 'e', 't']);
            });
        });
    });
});